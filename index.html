<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Ridwan Syarif Setiawan" />
    <title>Bus Intelligence Core</title>
    <meta name="description" content="Three.js">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --sub-text-color: #888;
            --primary-color: #5b6fef;
            --secondary-color: #5be9b9;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --border-color: #e0e0e0;
            --hover-color: #f5f5f5;
            --border-radius: 18px;
            --padding-unit: 20px;
            --gauge-primary: #95a5a6; /* Soft gray matching 3D model */
            --gauge-secondary: #7d8b8c; /* Slightly darker gray */
            --gauge-accent: #5b6fef; /* Soft blue accent */
        }

        /* [Previous CSS remains the same until .gauges-container] */

        .gauges-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .gauge {
            position: relative;
            width: 100%;
            height: 90px; /* Reduced from 120px */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .gauge-body {
            width: 90px; /* Fixed width for consistency */
            height: 45px; /* Half-circle proportion */
            position: relative;
            border-top-left-radius: 90px 90px;
            border-top-right-radius: 90px 90px;
            overflow: hidden;
            background-color: #f0f2f5; /* Light gray background */
        }
        
        .gauge-fill {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: conic-gradient(
                from 0.25turn at 50% 100%,
                var(--gauge-secondary) 0%,
                var(--gauge-primary) 50%,
                var(--gauge-accent) 100%
            );
            transform-origin: center top;
            transform: rotate(0.5turn);
            transition: transform 0.5s ease-out;
        }
        
        .gauge-cover {
            width: 60px; /* Reduced from 75% */
            height: 60px; /* Adjusted for new size */
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 15px; /* Adjusted position */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em; /* Slightly smaller text */
            font-weight: 600;
            color: var(--text-color);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.05) inset;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .gauge-title {
            font-size: 0.8em; /* Smaller text */
            color: var(--sub-text-color);
            margin-top: 5px;
            font-weight: 500;
        }
        
        .gauge-value {
            font-size: 1em; /* Smaller value display */
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .gauge-unit {
            font-size: 0.6em; /* Smaller unit text */
            color: var(--sub-text-color);
            margin-left: 2px;
        }

        /* [Rest of the CSS remains the same] */
    </style>        
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.132.2/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <!-- [Previous HTML remains the same until automotiveCard] -->

                <div id="automotiveCard" class="card">
                    <div class="card-header">
                        <h4>Bus Performance</h4>
                        <span class="more-options">...</span>
                    </div>
                    
                    <div class="gauges-container">
                        <div class="gauge">
                            <div class="gauge-body">
                                <div class="gauge-fill" id="speedFill"></div>
                                <div class="gauge-cover">
                                    <span class="gauge-value" id="speedValue">0</span>
                                    <span class="gauge-unit">km/h</span>
                                </div>
                            </div>
                            <div class="gauge-title">Speed</div>
                        </div>
                        
                        <div class="gauge">
                            <div class="gauge-body">
                                <div class="gauge-fill" id="rpmFill"></div>
                                <div class="gauge-cover">
                                    <span class="gauge-value" id="rpmValue">0</span>
                                    <span class="gauge-unit">x1000</span>
                                </div>
                            </div>
                            <div class="gauge-title">RPM</div>
                        </div>
                        
                        <div class="gauge">
                            <div class="gauge-body">
                                <div class="gauge-fill" id="engineTempFill"></div>
                                <div class="gauge-cover">
                                    <span class="gauge-value" id="engineTempValue">--</span>
                                    <span class="gauge-unit">°C</span>
                                </div>
                            </div>
                            <div class="gauge-title">Engine Temp</div>
                        </div>
                        
                        <div class="gauge">
                            <div class="gauge-body">
                                <div class="gauge-fill" id="fuelFill"></div>
                                <div class="gauge-cover">
                                    <span class="gauge-value" id="fuelValue">--</span>
                                    <span class="gauge-unit">%</span>
                                </div>
                            </div>
                            <div class="gauge-title">Fuel Level</div>
                        </div>
                    </div>
                    
                    <div class="status-indicators">
                        <div class="status-item">
                            <span class="status-icon status-normal"></span>
                            <span>Engine</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon status-normal"></span>
                            <span>Brakes</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon status-warning"></span>
                            <span>Tire Pressure</span>
                        </div>
                        <div class="status-item">
                            <span class="status-icon status-normal"></span>
                            <span>Battery</span>
                        </div>
                    </div>
                </div>

    <!-- [Rest of the HTML remains the same] -->

    <script type="module">
        // [Previous JavaScript remains the same until updateBusData function]

        function updateBusData() {
            const speed = Math.floor(Math.random() * 80) + 10;
            const latitude = -6.917464 + (Math.random() - 0.5) * 0.05;
            const longitude = 107.619123 + (Math.random() - 0.5) * 0.05;
            const engineTemp = Math.floor(Math.random() * (100 - 70 + 1)) + 70;
            const cabinTemp = Math.floor(Math.random() * (30 - 20 + 1)) + 20;
            const randomDistance = (Math.random() * 10).toFixed(1);
            const randomTime = Math.floor(Math.random() * 30) + 5;
            const rpm = (Math.random() * 3 + 1).toFixed(1);
            const fuelLevel = Math.floor(Math.random() * 100);

            // Update map
            updateBusOnMap(latitude, longitude);

            // Update dashboard
            busSpeedElement.textContent = speed;
            busDistanceElement.textContent = `${randomDistance} Km`;
            busTimeElement.textContent = `${randomTime} min`;
            engineTempElement.textContent = `${engineTemp} °C`;
            cabinTempElement.textContent = `${cabinTemp} °C`;
            
            // Update automotive infographic with softer movements
            speedValueElement.textContent = speed;
            speedFillElement.style.transform = `rotate(${(speed / 120) * 0.5}turn)`;
            
            engineTempValueElement.textContent = engineTemp;
            engineTempFillElement.style.transform = `rotate(${((engineTemp - 70) / 30) * 0.5}turn)`;
            
            rpmValueElement.textContent = rpm;
            rpmFillElement.style.transform = `rotate(${(rpm / 4) * 0.5}turn)`;
            
            fuelValueElement.textContent = fuelLevel;
            fuelFillElement.style.transform = `rotate(${(fuelLevel / 100) * 0.5}turn)`;
            
            // Update location text
            busLocationDetailedElement.textContent = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
            
            // Rotate bus model
            if (busModel) {
                busModel.rotation.y += 0.005;
            }
        }

        // [Rest of the JavaScript remains the same]
    </script>
</body>
</html>

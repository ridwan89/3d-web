<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="Ridwan Syarif Setiawan" />
        <title>Bus Intelligence Core</title>
        <meta name="description" content="Three.js">
        <style>
            body {
                overflow: hidden;
                margin: 0px;
                background-color: #ffffff; /* Ubah latar belakang body menjadi putih */
            }

            #progressBar {
                width: 500px;
                height: 24px;
                position: absolute;
                left: 50%;
                top: 10px;
                margin-left: -250px;
                z-index: 100;
            }
        </style>       
        <script type="importmap">
            {
                "imports": {
                    "three": "https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.module.js",
                    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.132.2/examples/jsm/"
                }
            }
        </script>
    </head>
    <body>
        <progress value="0" max="100" id="progressBar"></progress>
        <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
    
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xffffff); // Latar belakang putih
    
        // Pencahayaan merata (tanpa bayangan)
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.0); // Intensitas tinggi untuk pencahayaan merata
        scene.add(ambientLight);
    
        // Cahaya directional lembut (opsional, bisa dihapus)
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.3);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);
    
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 10;
    
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = false; // Nonaktifkan bayangan
        document.body.appendChild(renderer.domElement);
    
        // Kontrol orbit (bisa dinonaktifkan jika tidak diperlukan)
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enableZoom = false; // Nonaktifkan zoom
        controls.enablePan = false; // Nonaktifkan pan (geser)
    
        const progressBar = document.getElementById('progressBar');
    
        const objLoader = new OBJLoader();
        objLoader.load(
            'https://ridwan89.github.io/3d-web/model.obj',
            (object) => {
                progressBar.style.display = 'none';
                
                // Material abu-abu matte (tanpa bayangan)
                const grayMaterial = new THREE.MeshStandardMaterial({
                    color: 0xcccccc,
                    roughness: 0.7,
                    metalness: 0.0,
                    side: THREE.DoubleSide
                });
    
                object.traverse(function(child) {
                    if (child.isMesh) {
                        child.material = grayMaterial;
                        // Hapus bayangan (tidak diperlukan)
                        child.castShadow = false;
                        child.receiveShadow = false;
                    }
                });
                
                // Posisikan model di tengah
                const box = new THREE.Box3().setFromObject(object);
                const center = box.getCenter(new THREE.Vector3());
                object.position.sub(center);
                
                // Atur kamera agar pas dengan ukuran model
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = camera.fov * (Math.PI / 180);
                let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2)) * 1.2;
                
                camera.position.set(0, 0, cameraZ);
                camera.lookAt(0, 0, 0);
                controls.update();
                
                scene.add(object);
            },
            (xhr) => {
                if (xhr.lengthComputable) {
                    progressBar.value = (xhr.loaded / xhr.total) * 100;
                }
            },
            (error) => {
                console.error('Error loading OBJ:', error);
                progressBar.style.display = 'none';
            }
        );
    
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        window.addEventListener('resize', onWindowResize);
    
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
    </body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bus Intelligence Core</title>
    <style>
        body {
            overflow: hidden;
            margin: 0;
            font-family: 'Arial', sans-serif;
        }

        #welcomeScreen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease-out;
        }

        #welcomeContent {
            text-align: center;
            max-width: 600px;
            padding: 20px;
        }

        #logo {
            width: 120px;
            height: 120px;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease-out 0.5s forwards;
        }

        h1 {
            color: #3a4a6b;
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease-out 0.7s forwards;
        }

        p {
            color: #6b778d;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease-out 0.9s forwards;
        }

        #loadingContainer {
            width: 80%;
            max-width: 400px;
            margin-top: 30px;
            opacity: 0;
            animation: fadeIn 1s ease-out 1.1s forwards;
        }

        #progressBar {
            width: 100%;
            height: 8px;
            appearance: none;
            -webkit-appearance: none;
            border-radius: 4px;
            overflow: hidden;
            background: #d1d8e0;
        }

        #progressBar::-webkit-progress-bar {
            background: #d1d8e0;
            border-radius: 4px;
        }

        #progressBar::-webkit-progress-value {
            background: linear-gradient(90deg, #7b9acc 0%, #3a4a6b 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        .interactive-circle {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(123, 154, 204, 0.3);
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        #loadingText {
            color: #6b778d;
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0;
            animation: fadeIn 1s ease-out 1.3s forwards;
        }
    </style>
</head>
<body>
    <div id="welcomeScreen">
        <div id="particles-js"></div>
        <div id="welcomeContent">
            <svg id="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <path fill="#3a4a6b" d="M50 10L90 30V70L50 90L10 70V30L50 10Z" />
                <path fill="#7b9acc" d="M50 30L75 45V55L50 70L25 55V45L50 30Z" />
            </svg>
            <h1>Bus Intelligence Core</h1>
            <p>Loading advanced 3D visualization of our core infrastructure. Please wait while we prepare your interactive experience.</p>
            <div id="loadingContainer">
                <progress id="progressBar" value="0" max="100"></progress>
                <div id="loadingText">Initializing 3D environment...</div>
            </div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.132.2/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
        import Stats from 'https://ridwan89.github.io/3d-web/stats.module.js';

        // Initialize particles.js
        particlesJS('particles-js', {
            particles: {
                number: { value: 40, density: { enable: true, value_area: 800 } },
                color: { value: "#7b9acc" },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 150, color: "#d1d8e0", opacity: 0.3, width: 1 },
                move: { enable: true, speed: 1, direction: "none", random: true, straight: false, out_mode: "out" }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" }
                }
            }
        });

        // Create interactive circles that follow mouse
        document.addEventListener('mousemove', (e) => {
            const circle = document.createElement('div');
            circle.classList.add('interactive-circle');
            circle.style.left = e.clientX + 'px';
            circle.style.top = e.clientY + 'px';
            document.getElementById('welcomeScreen').appendChild(circle);
            
            // Remove circles after animation completes
            setTimeout(() => {
                circle.style.opacity = '0';
                circle.style.transform = `translate(-50%, -50%) scale(2)`;
                setTimeout(() => circle.remove(), 300);
            }, 500);
        });

        // Add floating animation to logo
        const logo = document.getElementById('logo');
        logo.style.animation = 'float 3s ease-in-out infinite';

        // Update loading text dynamically
        const loadingPhases = [
            "Loading 3D assets...",
            "Preparing textures...",
            "Setting up lighting...",
            "Almost there...",
            "Ready to launch!"
        ];

        const loadingText = document.getElementById('loadingText');
        let phaseIndex = 0;
        const phaseInterval = setInterval(() => {
            phaseIndex = (phaseIndex + 1) % loadingPhases.length;
            loadingText.textContent = loadingPhases[phaseIndex];
        }, 3000);

        // Three.js setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf5f7fa);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 10;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.maxPolarAngle = Math.PI / 2;
        controls.enableZoom = false;
        controls.enablePan = false;

        const progressBar = document.getElementById('progressBar');
        const welcomeScreen = document.getElementById('welcomeScreen');

        const objLoader = new OBJLoader();
        objLoader.load(
            'https://ridwan89.github.io/3d-web/model.obj',
            (object) => {
                // Transition out welcome screen
                welcomeScreen.style.opacity = '0';
                setTimeout(() => {
                    welcomeScreen.style.display = 'none';
                    clearInterval(phaseInterval);
                }, 1000);

                const grayMaterial = new THREE.MeshStandardMaterial({
                    color: 0xcccccc,
                    roughness: 2.0,
                    metalness: 0.0,
                    side: THREE.DoubleSide
                });

                object.traverse(function(child) {
                    if (child.isMesh) {
                        child.material = grayMaterial;
                        child.castShadow = true;
                        child.receiveShadow = false;
                    }
                });
                
                const box = new THREE.Box3().setFromObject(object);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                object.position.sub(center);
                
                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = camera.fov * (Math.PI / 180);
                let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                cameraZ *= 1.2;
                
                camera.position.set(cameraZ * 0.7, cameraZ * 0.5, cameraZ);
                camera.lookAt(0, 0, 0);
                controls.update();
                
                scene.add(object);
            },
            (xhr) => {
                if (xhr.lengthComputable) {
                    const percentComplete = (xhr.loaded / xhr.total) * 100;
                    progressBar.value = percentComplete;
                    
                    // Update loading text based on progress
                    if (percentComplete > 80) {
                        loadingText.textContent = "Finalizing...";
                    } else if (percentComplete > 60) {
                        loadingText.textContent = "Optimizing scene...";
                    } else if (percentComplete > 40) {
                        loadingText.textContent = "Loading geometry...";
                    } else if (percentComplete > 20) {
                        loadingText.textContent = "Processing textures...";
                    }
                }
            },
            (error) => {
                console.error('Error loading OBJ:', error);
                welcomeScreen.style.opacity = '0';
                setTimeout(() => {
                    welcomeScreen.style.display = 'none';
                    clearInterval(phaseInterval);
                }, 1000);
            }
        );

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            render();
        }
        window.addEventListener('resize', onWindowResize, false);

        const stats = new Stats();
        document.body.appendChild(stats.dom);

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            render();
            stats.update();
        }

        function render() {
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
